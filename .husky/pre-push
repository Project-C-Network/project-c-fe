#!/bin/sh (#To check unit test before push)
. "$(dirname "$0")/_/husky.sh"
pnpm test || (echo "Tests failed! Push aborted." && exit 1)

#!/bin/sh (#Run the test-all script to ensure all tests are run before push)
pnpm run test-all || (echo "Tests failed! Push aborted." && exit 1)

#!/bin/sh (#To check code format & unused variable, imports, exports etc.. before push)
pnpm lint-staged || (echo "Code is not clean!" && exit 1)

#!/bin/sh (#To prevent frequent push within 5 minutes)

LAST_PUSH_FILE=".git/last_push_time"

CURRENT_TIME=$(date +%s)

if [ ! -d ".git" ]; then
    echo "Not a valid Git repository. Push aborted."
    exit 1
fi

if [ -f "$LAST_PUSH_FILE" ]; then
    LAST_PUSH_TIME=$(cat "$LAST_PUSH_FILE" 2>/dev/null || echo 0)
    TIME_DIFF=$((CURRENT_TIME - LAST_PUSH_TIME))

    if [ $TIME_DIFF -lt 300 ]; then
        echo "You pushed less than 5 minutes ago. Please wait before pushing again."
        exit 1
    fi
fi

echo $CURRENT_TIME > "$LAST_PUSH_FILE"
